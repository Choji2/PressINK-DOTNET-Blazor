@page "/press-Admin/Manufactors/Update/{manuIdSTR}"
@using PressINK_Server_App.Services;

@using DB_SCHEMA.Data.PrinterContexts;
@using Microsoft.EntityFrameworkCore;
@using Web_scraper_practice_.Model.Printer_DB_Models;
@using Web_scraper_practice_.Model.Printer_DB_Models.Sub_models;
@inject PrinterService printerSerivce;
@inject NavigationManager NavigationManager;
@inject ISnackbar Snackbar;
@attribute [Authorize(Roles = SD.GODEMODE)]


<PageTitle>Manufacturer</PageTitle>


<MudPaper Class="d-flex  border-l-4 border-solid mud-border-primary pa-4 mb-5" Outlined="false" Elevation="0" Style="background-color:Transparent">
    <br />
    <MudText Typo="Typo.h2"><strong>Manufacturers</strong></MudText>
    <br />
    <br />
</MudPaper>


<MudPaper Class="" Outlined="false" Elevation="0" Style="background-color:transparent">
    <MudCard Outlined="true" Style="width:50%;">
        <MudCardContent>
            <EditForm Model="manu" OnValidSubmit="HandleSubmit">

                <DataAnnotationsValidator />
                @if (success)
                {
                    <MudText Color="@Color.Success"></MudText>
                }
                else
                {
                    <MudText Color="Color.Error">
                        <ValidationSummary />
                    </MudText>
                }

                <MudGrid>

                    <MudItem>
                        <MudTextField Label="Manufacturer ID" @bind-Value="@manu.MANUFACTOR_ID" For="@(()=>manu.MANUFACTOR_ID)" ReadOnly="true" />
                    </MudItem>

                    <MudItem>
                        <MudTextField Label="Name" @bind-Value="@manu.NAME" For="@(()=>manu.NAME)" />
                    </MudItem>

                    <MudItem sm="12">
                        <MudTextField Label="Desc." @bind-Value="@manu.DESCP" For="@(()=>manu.DESCP)" />
                    </MudItem>

                </MudGrid>

                <br />

                <MudButton Variant="Variant.Text" Color="Color.Primary" ButtonType="ButtonType.Submit">Update</MudButton>
                <MudButton Variant="Variant.Text" Color="Color.Primary" @onclick="Cancel">Cancel</MudButton>

            </EditForm>

        </MudCardContent>
    </MudCard>


</MudPaper>

@code {
    [Parameter]
    public string manuIdSTR { get; set; }

    public List<MANUFACTOR> manufactorList { get; set; }

    MANUFACTOR manu = new();
    bool success;

    protected override async Task OnInitializedAsync()
    {
        SetCurrent();
    }

    protected void SetCurrent()
    {
        MANUFACTOR oldManu = printerSerivce.GetManufactorByID(manuIdSTR);

        manu.MANUFACTOR_ID = oldManu.MANUFACTOR_ID;
        manu.NAME = oldManu.NAME;
        manu.DESCP = oldManu.DESCP;
    }

    private void HandleSubmit(EditContext editContext)
    {
        var updated = (MANUFACTOR)editContext.Model;
        success = true;

        printerSerivce.UpdateManufactor(updated);
        NavigationManager.NavigateTo($"{SD.IIS_NAV}/press-Admin/Manufactors");
        Show($"Manufacturer {manu.MANUFACTOR_ID} has been updated.",3);
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo($"{SD.IIS_NAV}/press-Admin/Manufactors");
        Show(SD.Cancel_sandbox, 2);
    }

    void Show(string message, int select)
    {
        if (select == 1)
        {
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomLeft;
            Snackbar.Add(message, Severity.Warning);
        }
        else if (select == 2)
        {
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomLeft;
            Snackbar.Add(message, Severity.Normal);
        }
        else
        {
            Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomLeft;
            Snackbar.Add(message, Severity.Success);
        }
    }
}