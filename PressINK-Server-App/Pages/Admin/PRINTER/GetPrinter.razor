
@page "/press-Admin/Printers"
@using PressINK_Server_App.Shared.Auth
@using Web_scraper_practice_.Model.Printer_DB_Models;
@using PressINK_Server_App.Services;
@inject PrinterService printerSerivce;
@inject NavigationManager NavigationManager;
@attribute [Authorize(Roles = SD.GODEMODE)]

<PageTitle>Printer</PageTitle>

<MudPaper Class="d-flex  border-l-4 border-solid mud-border-primary pa-4 mb-5" Outlined="false" Elevation="0" Style="background-color:Transparent" >
    <br />
    <MudText Typo="Typo.h2"><strong>Printers</strong></MudText>
    <LogoutButton/>
    <br />
    <br />
</MudPaper>

<MudLink Href="@($"{SD.IIS_NAV}/press-Admin")" Class="my-5">Back</MudLink>

<MudTable Items="printerlist" Hover="true" FixedHeader="@fixed_header" Height="500px" Filter="new Func<PRINTER_MAIN,bool>(FilterFunc1)" SortLabel="Sort By">

    <ToolBarContent>
        <MudSpacer />
        <MudSpacer />
        <MudTextField @bind-Value="searchString1" Placeholder="Search+Enter" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>

    <HeaderContent>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.ID)">Printer ID</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.HOSTNAMEv4)">Hostname v4</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.ASSET_NUMBER)">Asset#</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.QUE)">Que</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.LOCATION)">Location</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.MODEL_ID)">Model</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.PLANT_ID)">Plant ID</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<PRINTER_MAIN, object>(x=>x.CATEGORY_ID)">Category</MudTableSortLabel></MudTh>
 
        
        <MudTh></MudTh>
      
        <MudTh>
            <MudButton Variant="Variant.Outlined" Color="Color.Success" @onclick="CreatePage"> + Add</MudButton>
        </MudTh>

    </HeaderContent>

    <RowTemplate>

        <MudTd DataLabel="ID">@context.ID</MudTd>
        <MudTd DataLabel="Host"><MudLink Href="@($"http://{context.HOSTNAMEv4}")" target="_blank">@context.HOSTNAMEv4</MudLink></MudTd>
        <MudTd DataLabel="Asset">@context.ASSET_NUMBER</MudTd>
        <MudTd DataLabel="Queue">@context.QUE</MudTd>
        <MudTd DataLabel="Location">@context.LOCATION</MudTd>
        <MudTd DataLabel="Model">@context.MODEL_ID</MudTd>
        <MudTd DataLabel="Plant">@context.PLANT_ID</MudTd>
        <MudTd DataLabel="Category">@context.CATEGORY_ID</MudTd>
        <MudTd></MudTd>
        <MudTd DataLabel="Edit">
            <MudButtonGroup Variant="Variant.Outlined" Color="Color.Primary">
                <MudButton Color="Color.Primary" OnClick="@(e=>UpdatePage(context.ID))">Edit</MudButton>
                <MudButton Color="Color.Error" OnClick="@(e=>DeletePage(context.ID))">Remove</MudButton>
            </MudButtonGroup>
        </MudTd>

     
    </RowTemplate>

</MudTable>



@code {

    bool fixed_header = true;
    private string searchString1 = "";

    List<PRINTER_MAIN> printerlist;

    protected override async Task OnInitializedAsync()
    {
       
        printerlist = printerSerivce.GetPrinters();
    }

    protected void UpdatePage(int id)
    {
        NavigationManager.NavigateTo($"{SD.IIS_NAV}/press-Admin/Printers/Update/{id}");
    }
    protected void DeletePage(int id)
    {
        NavigationManager.NavigateTo($"{SD.IIS_NAV}/press-Admin/Printers/Delete/{id}");
    }
    protected void CreatePage()
    {
        NavigationManager.NavigateTo($"{SD.IIS_NAV}/press-Admin/Printers/Create");
    }


    private bool FilterFunc1(PRINTER_MAIN element) => FilterFunc(element, searchString1);

    private bool FilterFunc(PRINTER_MAIN element, string searchString)
    {
        if (string.IsNullOrWhiteSpace(searchString))
            return true;
        if (element.ASSET_NUMBER.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if (element.CATEGORY_ID.Contains(searchString, StringComparison.OrdinalIgnoreCase))
            return true;
        if ($"{element.HOSTNAMEv4.ToLower()} {element.QUE.ToLower()} {element.LOCATION.ToLower()} {element.MODEL_ID.ToLower()} {element.PLANT_ID.ToLower()}".Contains(searchString.ToLower()))
            return true;
        return false;
    }
}



